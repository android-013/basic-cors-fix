<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CORS Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.4; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin: 12px 0; }
    button { padding: 10px 14px; cursor: pointer; }
    code, pre { background: #f4f4f4; padding: 8px; border-radius: 6px; }
    pre { overflow: auto; }
    .card { border: 1px solid #ddd; padding: 14px; border-radius: 10px; max-width: 900px; }
    .muted { color: #666; }
    .ok { color: #0a7a0a; font-weight: 600; }
    .bad { color: #b00020; font-weight: 600; }
    input { padding: 8px; width: 360px; max-width: 90vw; }
  </style>
</head>
<body>
  <h1>CORS Error Test (Frontend)</h1>

  <div class="card">
    <div class="muted">Current page origin:</div>
    <pre id="origin"></pre>

    <div class="row">
      <label>
        Backend Base URL:
        <input id="baseUrl" value="http://localhost:4000" />
      </label>
    </div>

    <div class="row">
      <button id="btnHealth">GET /api/health</button>
      <button id="btnHello">GET /api/hello</button>
      <button id="btnEcho">POST /api/echo</button>
      <button id="btnClear">Clear Output</button>
    </div>

    <div class="muted">Result:</div>
    <pre id="out"></pre>

    <div class="muted">Status:</div>
    <div id="status"></div>
  </div>

  <script>
    const originEl = document.getElementById("origin");
    const outEl = document.getElementById("out");
    const statusEl = document.getElementById("status");
    const baseUrlEl = document.getElementById("baseUrl");

    originEl.textContent = window.location.origin;

    function setStatus(ok, text) {
      statusEl.innerHTML = `<span class="${ok ? "ok" : "bad"}">${text}</span>`;
    }

    function log(obj) {
      const current = outEl.textContent.trim();
      outEl.textContent = (current ? current + "\n\n" : "") + JSON.stringify(obj, null, 2);
    }

    async function doFetch(path, options = {}) {
      const baseUrl = baseUrlEl.value.replace(/\/$/, "");
      const url = baseUrl + path;

      setStatus(true, "Request sent...");
      try {
        const res = await fetch(url, {
          mode: "cors",
          ...options
        });

        const text = await res.text();
        let data;
        try { data = JSON.parse(text); } catch { data = { raw: text }; }

        log({ url, status: res.status, ok: res.ok, data });
        setStatus(res.ok, res.ok ? "Success" : "Request failed (check response)");
      } catch (e) {
        log({ url, error: String(e) });
        setStatus(false, "Blocked by browser (likely CORS) or network error");
      }
    }

    document.getElementById("btnHealth").onclick = () => doFetch("/api/health");
    document.getElementById("btnHello").onclick = () => doFetch("/api/hello");
    document.getElementById("btnEcho").onclick = () =>
      doFetch("/api/echo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: "Testing POST + preflight", at: new Date().toISOString() })
      });

    document.getElementById("btnClear").onclick = () => {
      outEl.textContent = "";
      setStatus(true, "Cleared");
    };
  </script>
</body>
</html>
